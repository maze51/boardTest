<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="board">

	<!-- 전체 게시판 목록 출력 -->
	<select id="showBoardList" resultType="boardVO">
		select * from BOARD
		order by BOARD_ID
	</select>
	
	<!-- 한 게시판의 전체 게시글 목록 출력 -->
	<select id="selectAllArticle" parameterType="string" resultType="articleVO">
		select *
		from ARTICLE
		where ARTICLE_BOARD = #{article_board}
	</select>
	
	<!-- 한 게시판의 전체 게시글수 조회 -->
	<select id="boardCnt" parameterType="string" resultType="int">
		select count(*) from ARTICLE
		where ARTICLE_BOARD = #{article_board}
	</select>
	
	<!-- 게시글 페이징 리스트 조회 -->
	<select id="articlePagingList" parameterType="map" resultType="articleVO">
	<![CDATA[
		select b.*
		from
		(select a.*, rownum rn
		from
		(select article.ARTICLE_NUMBER, article.ARTICLE_TITLE, article.ARTICLE_USER, article.ARTICLE_DATE, article.ARTICLE_USE, level lv
		from ARTICLE article
		where ARTICLE_BOARD = #{boardId}
		start with ARTICLE_PID is null
		connect by prior ARTICLE_NUMBER = ARTICLE_PID
		order siblings by ARTICLE_GROUP desc, ARTICLE_NUMBER) a) b
		where b.rn >= (#{page}-1)*#{pageSize} + 1 and b.rn <= #{page}*#{pageSize}
		]]>
	</select>
	
	<!-- 신규 게시판 생성 -->
	<insert id="createBoard" parameterType="map">
		insert into BOARD
		values('b' || to_char(boardtest_seq.nextval), #{userId}, #{boardName}, #{useSelect}, SYSDATE)
	</insert>
	
	<!-- 게시판 수정 -->
	<update id="modifyBoard" parameterType="map">
		update BOARD
		set BOARD_NAME = #{boardName}
			,BOARD_USE = #{useSelect}
		where BOARD_ID = #{boardId}
	</update>
	
	<!-- 개별 게시글 확인 -->
	<select id="readArticle" parameterType="int" resultType="articleVO">
		select *
		from ARTICLE
		where ARTICLE_NUMBER = #{article_number}
	</select>
	
	<!-- 게시글에 해당하는 댓글 확인 -->
	<select id="readReply" parameterType="int" resultType="replyVO">
		select *
		from REPLY
		where REPLY_ARTICLE = #{reply_article}
	</select>
	
	<!-- 개별 게시글 삭제 -->
	<update id="deleteArticle" parameterType="int">
		update ARTICLE
		set ARTICLE_USE = '0'
		where ARTICLE_NUMBER = #{article_number}
	</update>
</mapper>
